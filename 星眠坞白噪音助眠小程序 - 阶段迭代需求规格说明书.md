# 星眠坞白噪音助眠小程序 - 阶段迭代需求规格说明书

团队名称：星眠坞项目组

指导教师: -

团队成员: 刘昱含、齐紫薇

## 目录

第一章 项目概述..................................................... 1

1.1 迭代背景与目标.......................................................................................................... 1

1.2 核心迭代价值......................................................................................................... 1

1.3 迭代范围界定.......................................................................................................... 2

第二章 界面与美术设计迭代........................................... 2

2.1 全局设计规范调整（适配小程序）.............................................................................. 2

2.2 新增 / 优化模块美术需求........................................................................................... 3

第三章 核心功能迭代设计................................................. 4

3.1 白噪音助眠模块优化.............................................................................................. 4

3.2 分享与社交功能开发（小程序适配）........................................................................ 6

3.3 “小屋” 模块重构（原 “睡觉模块”）...................................................................... 7

3.4 播放历史模块优化.............................................................................................. 10

第四章 技术需求补充（小程序专项）.......................................... 10

4.1 前端技术迭代要求（基于小程序框架）...................................................................... 10

4.2 后端与云开发适配要求........................................................................................... 11

第五章 竞品迭代参考..................................................... 12

5.1 小程序竞品迭代趋势分析........................................................................................ 12

5.2 本项目迭代差异化亮点........................................................................................... 12

第六章 迭代盈利性关联分析.................................................. 13

6.1 迭代功能对现有盈利模式的强化................................................................................ 13

6.2 潜在盈利拓展点................................................................................................... 13

6.3 迭代风险与应对（小程序适配）.............................................................................. 13

## 第一章 项目概述

### 1.1 迭代背景与目标

基于 “星眠坞” 小程序 v1.0 版本核心功能落地基础，结合微信小程序 “轻量、便捷、强社交联动” 的平台特性，针对用户反馈的交互体验单一、场景化功能不足等问题，启动本阶段迭代开发。

本次迭代核心目标：优化白噪音模块交互流畅度与视觉统一性，新增场景化 “小屋” 模块丰富使用场景，基于微信生态实现音频分享功能，提升用户粘性与小程序传播效率。

### 1.2 核心迭代价值



| 用户痛点               | 迭代解决方案                                 | 商业价值转化点                 |
| ------------------ | -------------------------------------- | ----------------------- |
| 白噪音交互缺乏趣味性，操作反馈弱   | 新增小色子猫猫头动画、去边框按钮设计，统一色彩体系适配小程序风格       | 提升用户停留时长，增加流量主广告曝光机会    |
| 助眠场景局限，缺乏学习 / 情感互动 | 重构 “小屋” 模块，整合自习室、晚安邮箱、睡眠故事场景           | 拓展用户使用场景，提升日活与留存率       |
| 小程序传播渠道单一，社交属性弱    | 基于微信 API 实现音频分享至好友 / 群聊，适配朋友圈分享（若类目支持） | 依托微信社交链降低获客成本，提升小程序扩散速度 |
| 收藏组合管理混乱，标识不清晰     | 优化收藏组合命名规则与展示逻辑，适配小程序列表展示特性            | 提升功能使用率，增强用户操作连贯性       |

### 1.3 迭代范围界定



1. 现有功能优化：白噪音助眠模块（随机推荐、播放控制、收藏功能）、播放历史模块；

2. 新增功能开发：音频微信分享功能、“小屋” 模块（自习室、晚安邮箱、睡眠故事）；

3. 全局设计调整：遵循微信小程序 UI 规范，实现色彩统一、按钮样式优化、播放设置半屏弹窗适配；

4. 技术适配：小程序动画效果实现、音频混合时长标准化、基于云开发的消息投递存储机制。

## 第二章 界面与美术设计迭代

### 2.1 全局设计规范调整（适配小程序）



1. 设计原则遵循：严格按照微信小程序 “清晰、一致、简洁” 设计原则，界面布局避免过度复杂，突出核心功能入口；

2. 色彩体系统一：主色调定为浅紫 / 蓝色系（#E6E6FA-#B0C4DE），辅助色保持一致性（收藏按钮默认 #E5E5E5，选中 #FF6B6B），与微信生态视觉风格协调；

3. 按钮样式优化：全局按钮去除边框设计，采用 “图标 + 文字” 组合形式，复用微信小程序 WeUI 组件库的交互反馈逻辑，通过色彩深浅变化区分默认 / 点击 / 禁用状态；

4. 字体规范：使用微信小程序系统默认字体，标题字号 18px，正文 14px，辅助文字 12px，确保不同设备渲染一致性；

5. 页面结构：统一采用 “导航栏 + 内容区 + 底部操作区” 结构，导航栏复用微信原生组件，减少自定义组件带来的性能损耗。

### 2.2 新增 / 优化模块美术需求



1. 白噪音模块优化：

* 小色子图标：透明度调整为 80%，下方文字改为纯白色（#FFFFFF），图标尺寸适配小程序标准控件大小（40rpx×40rpx）；

* 猫猫头动画：采用线条简约风格，旋转动画时长 0.5 秒，循环 3 次后停止，动画文件大小控制在 50KB 以内，避免影响加载速度；

* 播放详情页：收藏按钮（爱心图标）顶部预留收藏数量显示空间，字体采用 12px 系统默认字体，与 WeUI 列表项样式统一；

* 播放设置页面：半屏弹窗采用底部弹出样式，高度占屏幕 50%，顶部添加圆角（16rpx），背景使用 rgba (255,255,255,0.9) 搭配模糊效果，符合小程序弹窗设计规范。

1. “小屋” 模块设计：

* 小屋主页：静态场景图采用 WebP 格式，压缩后大小≤200KB，确保首屏加载时间≤1.5 秒；

* 自习室场景：明亮色调搭配书桌、绿植等轻量元素，计时器采用环形进度条设计，直径 120rpx，位置居中展示；

* 睡觉场景：深紫底色（#3A3A52）搭配白色星星 / 月亮图标，控件对比度≥4.5:1，符合小程序 accessibility 规范；

* 睡眠故事列表：采用 WeUI 的`weui-media-box`组件布局，封面图尺寸 160rpx×120rpx，标题与时长上下排列。

1. 晚安邮箱设计：

* 核心按钮：“投递”“接收” 按钮采用小程序主操作按钮样式（背景 #7B61FF，文字白色），尺寸适配单手操作（宽度 280rpx，高度 80rpx）；

* 消息气泡：采用圆角矩形设计（半径 16rpx），发送方气泡背景 #7B61FF，接收方 #E5E5E5，文字内边距 24rpx。

## 第三章 核心功能迭代设计

### 3.1 白噪音助眠模块优化

#### 3.1.1 随机推荐功能（优化）



* 交互效果：点击小色子图标后，触发猫猫头旋转动画，动画通过 CSS3 `@keyframes` 实现，避免使用 Canvas 占用过多资源；

* 视觉反馈：动画执行期间小色子图标置灰禁用，防止重复点击，动画结束后自动加载推荐音频，加载状态用 WeUI `weui-loading` 组件展示。

#### 3.1.2 播放控制功能（新增 / 修改）



* 音频时长展示：播放进度条下方显示 “当前时间 / 总时长”（如 “01:23/03:30”），采用小程序原生`wx.createInnerAudioContext` API 获取实时进度，更新频率 1 秒 / 次；

* 多音频混合规则：所有参与混合的音频统一标准化处理，仅支持 3 分 30 秒、4 分钟两种时长选择，默认选中 3 分 30 秒，通过云函数预处理音频文件确保音质；

* 播放设置页面：


  * 交互逻辑：点击设置按钮弹出半屏弹窗，通过小程序`wx.showModal` 二次封装实现，支持点击蒙层关闭；

  * 控件调整：移除 “音效”“音频信息” 选项，音量调节使用小程序原生`slider` 组件，最小值 0，最大值 100，步长 1；

  * 层级管理：弹窗层级设为 100，高于页面其他元素，避免被导航栏遮挡。

#### 3.1.3 收藏功能（优化）



* 收藏数量显示：爱心图标顶部显示收藏数，格式为 “数字 + 收藏”（如 “128 收藏”），数据通过云数据库实时同步，更新时添加数字变化动画；

* 组合命名规则：


  * 命名入口：收藏时弹出小程序`input` 组件，提示 “请输入组合名称（1-12 字）”，未输入则默认 “白噪音组合”；

  * 存储逻辑：组合名称与音频 ID 列表绑定存储至用户专属云数据库集合，关联用户微信 openid；

* 收藏逻辑：无论用户选择 1-3 个音频，均默认收藏全部选中项，收藏成功后通过`wx.showToast` 提示 “组合收藏成功”。

### 3.2 分享与社交功能开发（小程序适配）

#### 3.2.1 音频分享功能（新增）



* 基础配置：


  * 在`app.json` 中声明分享权限：`"enableShareAppMessage": true, "enableShareTimeline": true`（基础库≥2.11.3）；

  * 小程序完成微信认证并绑定开放平台账号，确保分享功能权限开通；

* 分享入口：音频详情页右上角添加 “分享” 图标（复用微信原生分享入口样式），或通过长按音频卡片触发分享菜单；

* 分享逻辑：


  * 分享给好友 / 群聊：通过`onShareAppMessage` 接口实现，返回参数包括标题（“推荐 \[组合名称] 白噪音”）、路径（携带音频组合 ID 参数，如 “/pages/play/play?id=xxx”）、缩略图（音频封面图，尺寸 5:4）；

  * 分享到朋友圈：通过`onShareTimeline` 接口实现，标题默认 “星眠坞助眠白噪音，一起来听～”，query 参数携带分享者标识便于数据统计；

* 接收逻辑：被分享用户点击链接后，小程序通过`onLoad` 解析 query 参数，直接跳转至对应音频播放页并自动加载内容。

#### 3.2.2 社区互动简化（适配小程序轻量特性）



* 互动形式：暂不开发独立社区模块，聚焦 “分享 - 播放” 核心链路，被分享者播放后可直接进行收藏、二次分享操作；

* 数据统计：通过云函数记录分享次数、点击转化率，数据同步至小程序数据助手，支持按分享渠道分析。

### 3.3 “小屋” 模块重构（原 “睡觉模块”）

#### 3.3.1 模块入口调整



* 导航栏优化：底部导航栏 “睡觉” 模块更名为 “小屋”，图标采用微信小程序图标库中的房屋矢量图标，尺寸 40rpx×40rpx；

* 跳转逻辑：点击入口后通过`wx.navigateTo` 跳转至小屋主页，页面加载时优先展示缓存的静态场景图，后台异步加载动态数据。

#### 3.3.2 学习场景（自习室）



* 页面布局：采用上下分区设计，上半部分为场景展示区，下半部分为功能控制区（计时器 + 音乐选择 + 操作按钮）；

* 计时器功能：


  * 时长设置：支持自定义输入（10 分钟 - 2 小时）及预设选项（10 分钟、30 分钟、1 小时、2 小时），预设选项复用 WeUI `weui-btn` 组件；

  * 进度展示：环形进度条使用`wx.createCanvasContext` 绘制，剩余时间 < 5 分钟时进度条变为橙色，<1 分钟时变为红色；

  * 计时结束：触发轻柔提示音（音频文件≤10KB），同时通过`wx.showModal` 提示 “专注时间结束啦～”；

* 音乐控制：


  * 音源管理：专注类白噪音存储于微信云存储，通过`wx.cloud``.getTempFileURL` 获取临时播放链接；

  * 操作控件：播放 / 暂停按钮复用白噪音模块控件，音乐列表采用下拉弹窗展示，最多显示 8 条内容；

* 状态保存：通过`wx.setStorageSync` 缓存计时器状态与当前播放音乐，小程序重启后可恢复上次状态。

#### 3.3.3 睡觉场景



* 页面切换：从小屋主页点击 “睡觉” 按钮后，触发淡入淡出过渡动画（时长 300ms），同步降低背景亮度；

* 功能入口：“晚安邮箱”“睡眠故事” 采用并列卡片布局，每个卡片尺寸 320rpx×180rpx，间距 20rpx；

##### 3.3.3.1 晚安邮箱（类漂流瓶功能）



* 核心机制：基于微信云开发实现，采用 “投递 - 接收 - 回信” 闭环流程，确保匿名性与消息安全性；

* 投递晚安：


  * 输入控件：使用小程序`textarea` 组件，最大长度 500 字，显示字数统计，支持表情输入；

  * 投递逻辑：点击 “投递” 后调用云函数`throwBottle`，将内容加密存储至`bottles` 集合（包含内容、投放时间、openid），同时更新用户投递次数（每日上限 5 次）；

  * 反馈提示：投递成功后显示 “晚安已出发～”Toast，失败则提示 “网络不佳，请重试” 并提供重试按钮；

* 接收晚安：


  * 匹配机制：点击 “接收晚安” 调用云函数`pickBottle`，从`bottles` 集合随机抽取 1-2 条未被领取的消息，标记领取状态并关联接收者 openid；

  * 内容展示：接收的消息显示在气泡中，底部提供 “忽略”“回信” 两个操作按钮，点击 “忽略” 则释放消息重新进入待领取池；

* 回信功能：


  * 输入限制：回信内容最大长度 300 字，仅可对接收的消息回信 1 次；

  * 存储逻辑：回信内容存储至`replies` 集合，关联原消息 ID 与双方 openid，仅消息双方可见；

* 我的信箱：


  * 列表展示：按接收时间倒序排列，未读消息左侧添加红色圆点标记，每条消息显示内容预览（前 20 字）、接收时间；

  * 操作功能：支持左滑删除单条消息，点击消息进入详情页查看完整内容及回信记录；

* 合规性保障：


  * 内容过滤：投递内容调用微信内容安全 API 进行校验，含敏感信息则拦截并提示 “内容不符合规范”；

  * 隐私保护：所有消息仅存储内容与时间，不关联用户真实身份信息，用户可在设置中清除所有信箱记录。

##### 3.3.3.2 睡眠故事



* 列表展示：


  * 数据加载：采用分页加载模式，每次加载 10 条故事数据，下拉到底部自动加载下一页；

  * 筛选功能：顶部添加 “最新”“最热” 切换按钮，点击后调用云函数`getStories` 按对应字段排序；

  * 展示字段：每条故事显示封面图、标题、时长（如 “15 分钟”）、简介（限 30 字），点击封面图可查看完整故事；

* 详情页：


  * 布局设计：左侧 3/5 区域为文字内容（字号 16px，行高 1.6），右侧 2/5 区域为音频播放控件；

  * 播放控制：复用白噪音模块播放逻辑，支持后台播放，退出详情页后通过悬浮球（固定于右下角，尺寸 60rpx×60rpx）控制；

  * 缓存机制：故事音频支持预加载，文字内容缓存至本地，下次进入无需重新请求。

### 3.4 播放历史模块优化



* 数据存储：播放记录存储于`playHistory` 云数据库集合，包含音频 ID 列表、播放时间、播放时长，按用户 openid 分区；

* 展示规则：


  * 单个音频：显示音频名称 + 播放时间（如 “2025-11-13 22:30”）；

  * 混合组合：统一格式为 “白噪音：\[音频 1 名称]，\[音频 2 名称]，\[音频 3 名称]”，不足 3 个按实际数量展示，不显示自定义名称；

* 清理功能：长按历史记录弹出 “删除” 选项，支持单次删除单条记录，或通过 “清空历史” 按钮批量删除（需二次确认）。

## 第四章 技术需求补充（小程序专项）

### 4.1 前端技术迭代要求（基于小程序框架）



1. 动画与交互：

* 猫猫头动画：使用 WXSS `@keyframes` 实现旋转效果，关键帧设置 0%（初始角度）、50%（旋转 180°）、100%（旋转 360°），循环 3 次；

* 页面过渡：通过小程序`page-container` 组件实现页面切换动画，配置`show` 与`duration` 属性控制显示与时长；

* 按钮反馈：所有按钮添加`hover-class` 样式，点击时背景色加深 10%，反馈延迟≤100ms。

1. 音频处理（适配小程序限制）：

* 音频播放：统一使用`wx.createInnerAudioContext` API，设置`obeyMuteSwitch: false` 确保静音模式下可播放；

* 混合音频：提前在云存储生成 3 分 30 秒、4 分钟两种时长的标准化音频片段，混合时直接调用片段拼接，避免前端实时混合导致的性能问题；

* 进度同步：通过`onTimeUpdate` 事件实时获取播放进度，更新 UI 时使用`this.setData` 优化渲染性能，避免频繁更新。

1. 界面适配：

* 响应式布局：采用 Flex 布局与 rpx 单位，确保在 320px-414px 宽度设备上控件无错位；

* 弹窗适配：播放设置半屏弹窗使用`wx.getSystemInfoSync()` 获取屏幕高度，动态设置弹窗高度为`screenHeight * 0.5`；

* 暗黑模式：适配微信暗黑模式，通过`wx.getSystemInfoSync().theme` 判断主题，自动切换对应样式文件。

1. 性能优化：

* 图片优化：所有图片使用云存储的图片处理接口压缩，设置合适的宽高比，避免拉伸变形；

* 数据缓存：高频访问数据（如用户收藏、播放历史）通过`wx.setStorageSync` 缓存，缓存有效期 24 小时；

* 组件复用：将播放控件、列表项等通用元素封装为自定义组件，减少代码冗余，提升维护效率。

### 4.2 后端与云开发适配要求



1. 云开发架构：

* 数据库设计：


  * `user` 集合：存储用户 openid、昵称、头像、收藏列表 ID；

  * `audio` 集合：存储音频 ID、名称、封面图、标准化音频链接、分类；

  * `audioComb` 集合：存储组合 ID、音频 ID 列表、组合名称、收藏数量；

  * `playHistory` 集合：存储用户 openid、音频 ID 列表、播放时间；

  * `bottles` 集合：存储瓶子 ID、内容、投放时间、领取状态、接收者 openid；

  * `replies` 集合：存储回复 ID、瓶子 ID、回复内容、回复时间；

* 云函数开发：


  * `getAudio`：获取音频列表与详情；

  * `saveComb`：保存收藏组合；

  * `throwBottle`/`pickBottle`：处理晚安邮箱投递与接收；

  * `getContentCheck`：调用微信内容安全 API 校验消息内容；

1. 接口规范：

* 所有接口采用 HTTPS 协议，返回数据格式统一为`{code: 0/1, msg: "提示信息", data: {}}`，code=0 表示成功，code=1 表示失败；

* 分页接口统一使用`page`（页码）与`size`（每页条数）参数，默认 size=10；

1. 权限控制：

* 数据库集合设置访问权限，仅用户可读写自己的历史记录与信箱消息；

* 云函数添加用户身份校验，通过`event.userInfo.openid` 确认操作权限，防止越权访问；

1. 消息推送：

* 当有用户回复消息时，通过微信订阅消息 API 推送提醒，需用户提前授权`subscribeMessage` 权限；

* 订阅消息模板选择 “通知类” 模板，内容为 “您有一条新的晚安回复，快来看看吧～”。

## 第五章 竞品迭代参考

### 5.1 小程序竞品迭代趋势分析



* 轻量场景化：头部助眠小程序（如 “小睡眠”“潮汐”）均采用场景化设计，将功能与学习、工作等场景绑定，减少用户决策成本；

* 社交轻量化：多依托微信分享实现传播，避免开发独立社区导致的小程序体积过大，聚焦 “分享 - 使用” 短链路；

* 云开发普及：多数小程序采用微信云开发降低后端维护成本，提升迭代效率；

* 合规性强化：情感互动功能均接入内容安全校验，避免违规内容传播风险。

### 5.2 本项目迭代差异化亮点



1. 场景融合创新：将学习与助眠场景整合至 “小屋” 模块，实现 “一站式” 休闲需求，区别于竞品单一助眠场景；

2. 社交功能轻量化：基于微信原生分享 API 实现传播，同时通过晚安邮箱功能补充情感互动，兼顾传播效率与用户粘性；

3. 音频标准化设计：混合音频时长统一为 3 分 30 秒 / 4 分钟，适配小程序音频播放限制，提升播放稳定性；

4. 视觉风格年轻化：猫猫头动画、去边框按钮等设计元素符合 Z 世代审美，区别于传统助眠产品的严肃风格。

## 第六章 迭代盈利性关联分析

### 6.1 迭代功能对现有盈利模式的强化



1. 流量主广告：

* 场景植入：自习室计时结束后、晚安邮箱投递成功后插入激励视频广告，观看后可获得 “额外计时 10 分钟”“增加投递次数 1 次” 等奖励；

* Banner 广告：在睡眠故事列表底部添加小程序 Banner 广告，尺寸适配小程序规范（320rpx×80rpx）；

1. 增值服务转化：

* 会员特权：开通会员可解锁 “无广告体验”“自定义组合封面”“晚安邮箱定向投递” 等功能，会员价格 9.9 元 / 月；

* 内容付费：睡眠故事模块设置 “独家故事” 分类，单篇故事售价 1.9 元，或包含在会员权益中。

### 6.2 潜在盈利拓展点



1. 品牌合作：自习室场景可与文具、咖啡等品牌合作，植入定制化场景皮肤（如 “XX 咖啡主题自习室”）；

2. 内容分销：邀请优质主播入驻睡眠故事模块，采用 “平台抽成” 模式（主播获得收入的 70%，平台 30%）；

3. 数据服务：在合规前提下，分析用户睡眠习惯数据，为健康品牌提供匿名数据报告服务。

### 6.3 迭代风险与应对（小程序适配）



1. 风险：分享功能因类目限制无法开通朋友圈分享；

   应对：优先确保好友 / 群聊分享功能实现，若类目受限则强化群聊分享引导，如 “分享至学习群，组队专注”；

2. 风险：音频播放受小程序后台限制，切换页面后中断；

   应对：使用小程序`background-audio-manager` API 实现后台播放，提前在小程序配置中声明 “音频播放” 类目；

3. 风险：晚安邮箱内容审核不通过，导致小程序下架；

   应对：接入微信内容安全 API 进行实时校验，同时建立人工审核机制，对高频违规用户限制功能使用；

4. 风险：云开发资源超限导致服务不稳定；

   应对：合理配置云函数内存与数据库容量，设置资源监控告警，根据用户量动态扩容。

> （注：文档部分内容可能由 AI 生成）